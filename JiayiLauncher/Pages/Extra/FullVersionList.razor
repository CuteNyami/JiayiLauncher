@page "/Versions/Full/{version?}"
@using JiayiLauncher.Features.Versions

<div class="find-tools">
    <span class="material-symbols-sharp">search</span>
    <JiayiTextBox Placeholder="Search versions" @ref="_searchBox" Changed="StateHasChanged" />

    <p class="invisible-normalizer">invisible</p>
</div>

<div class="version-list-page">
    @if (_versionList != null)
    {
        var versions = _versionList.Where(
            v => v.Key.Contains(_searchBox?.Value ?? "", StringComparison.OrdinalIgnoreCase)).ToList();
        
        if (versions.Count == 0)
        {
            <i class="no-versions">No versions found</i>
        }
        else
        {
            <ul class="versions">
                @for (var i = 0; i < Math.Min(_amountToDisplay, versions.Count); i++)
                {
                    var name = versions[i].Key;
                    var version = versions[i].Value;
                    
                    <li class="version">
                        <strong>@name</strong>
                    </li>
                }
            </ul>
            
            @if (versions.Count > _amountToDisplay)
            {
                <div class="load-more-box">
                    <a class="load-more" @onclick="() => _amountToDisplay += 10">Load more</a>
                    <span class="material-symbols-sharp">expand_more</span>
                </div>
            }
        }
    }
</div>

@code {
    [Parameter]
    public string? Version { get; set; }

    private Dictionary<string, MinecraftVersion>? _versionList;
    private int _amountToDisplay = 10;
    
    private JiayiTextBox? _searchBox;

    protected override async Task OnInitializedAsync()
    {
        _versionList = await VersionList.GetFullVersionList();
    }

    protected override void OnParametersSet()
    {
        Version ??= "None";
    }
}